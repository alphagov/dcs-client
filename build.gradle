apply plugin: 'java'
apply plugin: 'application'

version='0.0.1'

repositories {
    mavenCentral()
}

dependencies {
    compile(
        'io.dropwizard:dropwizard-core:1.0.5',
        'io.dropwizard:dropwizard-client:1.0.5',
        'com.nimbusds:nimbus-jose-jwt:4.0',
        'commons-codec:commons-codec:1.7',
        'eu.appsatori:gradle-fatjar-plugin:0.2'
    )
    testCompile(
        'junit:junit:4.12',
        'io.dropwizard:dropwizard-testing:1.1.0',
        'org.mockito:mockito-core:2.7.22'
    )
}

compileTestJava {
    options.fork = true
    options.forkOptions.executable = 'javac'
    options.compilerArgs << "-XDignore.symbol.file"
}

task fatJar(type: Jar) {
    baseName = project.name
    from { configurations.compile.collect { it.isDirectory() ? it : zipTree(it) } }
    with jar
    manifest {
        attributes(
            'Implementation-Title': 'DCS Client',
            'Implementation-Version': version,
            'Main-Class': 'uk.gov.ida.dcsclient.DcsClientApplication'
        )
    }
}

run {
    args = ["server", "configuration/dcs-client.yml"]
}

mainClassName = 'uk.gov.ida.dcsclient.DcsClientApplication'