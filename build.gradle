apply plugin: 'java'
apply plugin: 'application'

version='0.0.1'

repositories {
    mavenCentral()
}

dependencies {
    compile(
        'io.dropwizard:dropwizard-core:1.1.0',
        'io.dropwizard:dropwizard-client:1.1.0',
        'com.nimbusds:nimbus-jose-jwt:4.0',
        'commons-codec:commons-codec:1.7'
    )
    testCompile(
        'junit:junit:4.12',
        'io.dropwizard:dropwizard-testing:1.1.0',
        'org.mockito:mockito-core:2.7.22'
    )
}

run {
    args = ["server", "configuration/dcs-client.yml"]
}

mainClassName = 'uk.gov.ida.dcsclient.DcsClientApplication'

compileTestJava {
    options.fork = true
    options.forkOptions.executable = 'javac'
    options.compilerArgs << "-XDignore.symbol.file"
}


// ----- CREATE FATJAR ---- //

buildscript {
    repositories { jcenter() }
    dependencies {
        classpath 'com.github.jengelman.gradle.plugins:shadow:1.2.3'
    }
}
apply plugin: 'com.github.johnrengelman.shadow'

shadowJar {
    baseName = project.name
    mergeServiceFiles()
    manifest {
        attributes(
            'Implementation-Title': 'DCS Client',
            'Implementation-Version': version,
            'Main-Class': 'uk.gov.ida.dcsclient.DcsClientApplication'
        )
    }
}

// --------- //
